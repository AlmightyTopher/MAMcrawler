[tool:pytest]
# MAMcrawler Unified Testing Configuration
# =======================================

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = *TestCase
python_functions = test_*

# Markers for different test types
markers =
    unit: Unit tests for individual components
    integration: Integration tests for component interactions
    e2e: End-to-end tests for full workflows
    performance: Performance and load tests
    api: API endpoint tests
    database: Database testing with fixtures
    slow: Tests that take longer than 30 seconds
    flaky: Tests that may fail intermittently
    skip_ci: Tests to skip in CI environment

# Test execution
addopts =
    --strict-markers
    --strict-config
    --disable-warnings
    --tb=short
    -ra
    --cov=.
    --cov-report=html:htmlcov
    --cov-report=json:coverage.json
    --cov-report=term-missing
    --cov-fail-under=80

# Coverage configuration
[coverage:run]
source = .
omit =
    */venv/*
    */.venv/*
    */__pycache__/*
    */tests/*
    */test_*
    setup.py
    conftest.py

[coverage:report]
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    class .*\bProtocol\):
    @(abc\.)?abstractmethod

[coverage:html]
directory = test_reports/coverage_html

# Logging configuration for tests
[logging]
version = 1
disable_existing_loggers = false

[loggers]
keys = root, mamcrawler

[handlers]
keys = console, file

[formatters]
keys = simple, detailed

[logger_root]
level = INFO
handlers = console

[logger_mamcrawler]
level = DEBUG
handlers = file
qualname = mamcrawler
propagate = 0

[handler_console]
class = StreamHandler
level = INFO
formatter = simple
args = (sys.stdout,)

[handler_file]
class = FileHandler
level = DEBUG
formatter = detailed
args = ('test_debug.log', 'w')

[formatter_simple]
format = %(asctime)s [%(levelname)s] %(message)s
datefmt = %H:%M:%S

[formatter_detailed]
format = %(asctime)s [%(levelname)s] %(name)s:%(lineno)d - %(message)s
datefmt = %Y-%m-%d %H:%M:%S