<original_task>
Security Hardening, Input Validation, and Project Health Audit.
Also included: Verifying the Dual VPN Scraper setup and updating the "Tunnel to Production" epic.
</original_task>

<work_completed>
- **Security Hardening (MAMcrawler-hf1 - CLOSED):**
  - **Secrets:** Replaced hardcoded `QB_PASSWORD` in `backend/integrations/qbittorrent_resilient.py` with `os.getenv("QB_PASSWORD", "adminadmin")`.
  - **Rate Limiting:** Added `@limiter.limit` decorators to critical Admin API routes (`/login`, `/users`, `/users/{id}/password`) in `backend/routes/admin.py`.
  - **Input Validation:** Audited Pydantic models in `backend/routes/books.py` and `admin.py`. Confirmed global middleware in `backend/main.py` protects against path traversal.
  - **Artifacts:** `backend/integrations/qbittorrent_resilient.py`, `backend/routes/admin.py`.

- **MAMcrawler-0dm (Epic):**
  - Updated epic description to reflect child task status.
  - Status: `in_progress`.

- **Dual VPN Scraper Verification (MAMcrawler-cpe - BLOCKED):**
  - **Script:** Updated `verify_wireguard.py` to use `ipify` and handle errors robustly.
  - **Findings:** Verification FAILED. Both Python and Windows System traffic share the same external IP (`159.26.103.209`). Split tunneling is NOT active/working.
  - **Action:** Marked issue `MAMcrawler-cpe` as `blocked`.

- **Project Health Audit (MAMcrawler-btx - CLOSED):**
  - **Analysis:** Reviewed system state. Security is improved. Network is the main blocker. Data Silo (JSON vs DB) is the main architectural flaw.
  - **Artifact:** Updated `PROJECT_HEALTH_AUDIT.md` with "YELLOW" status, noted security wins, flagged network blocker, and emphasized the Data Silo risk.
</work_completed>

<work_remaining>
- **Network / VPN Fix (Critical for Dual Scraper):**
  - Debug WireGuard routing. The `TopherTek-Python-Tunnel.conf` likely captures all traffic or the `setup_wireguard_python_tunnel.ps1` script's routing rules were overridden.
  - Goal: Python uses VPN IP, System uses ISP IP.

- **Data Silo Refactor (Recommended Next Step):**
  - The `DiscoveryService` and `MAMSeleniumService` are still file-based (JSON).
  - Port them to use SQLAlchemy models (`Book`, `Download`) and write to PostgreSQL.
  - This is required for the Dashboard to show real-time stats.

- **Orphaned Features:**
  - `audiobookshelf_hardcover_sync.py` needs to be wrapped in a Service class and exposed via an API endpoint.
</work_remaining>

<attempted_approaches>
- **VPN Verification:** Used `verify_wireguard.py`. Result showed identical IPs (159.x.x.x), proving the tunnel is up but capturing all traffic (or at least the traffic for the test sites).
</attempted_approaches>

<critical_context>
- **VPN Config:** Located at `C:\ProgramData\WireGuard\TopherTek-Python-Tunnel.conf`.
- **Project Structure:** "Unified" architecture, but data flow is split between DB (API) and Files (Workers). This "Data Silo" must be unified for production readiness.
- **Issues:**
  - `MAMcrawler-0dm` (Epic) - In Progress
  - `MAMcrawler-cpe` (Dual VPN) - Blocked
  - `MAMcrawler-hf1` (Security) - Closed
  - `MAMcrawler-btx` (Audit) - Closed
- **Environment:** Windows 10/11. Python 3.11. `beads` CLI used for task tracking.
</critical_context>

<current_state>
- **Security:** Much improved (Secrets, Rate Limits).
- **Network:** Broken (Split Tunnel fails).
- **Audit:** Complete and documented.
- **Ready for:** Either heavy network debugging (if Dual Scraper is priority) OR Data Silo refactoring (if App Stability is priority).
</current_state>
